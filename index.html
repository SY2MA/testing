<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>BPER Banca - Mobile Banking</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BPER Banking">
    <link rel="apple-touch-icon" href="/path/to/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/path/to/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/path/to/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/path/to/apple-touch-icon-167x167.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root{
            --g1:#005057;
            --g2:#005057;
            --g3:#005057;
            --g4:#e0f2f1;
            --g5:#005057;
            --g6:#f0fafa;
            --wc:#fff;
            --lc:#f0f0f0;
            --ic:var(--g5);
            --bc:#e0e0e0;
            --sh:0 4px 12px rgba(0,0,0,.08);
            --mp:var(--g2); /* CHANGED: Positive money color to g2 */
            --mn:var(--g2); /* CHANGED: Negative money color to g2 */
            --pb:env(safe-area-inset-bottom);
            --pl:env(safe-area-inset-left);
            --pr:env(safe-area-inset-right);
        }
        body{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;margin:0;padding:0;background-color:var(--g3);color:var(--g2);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden;display:flex;flex-direction:column;min-height:100vh}
        /* REMOVED: .status-bar CSS */
        .app-header{background-color:var(--g1);color:var(--wc);padding:0 20px;position:sticky;top:0;z-index:90;box-shadow:none;}.header-top{display:flex;justify-content:space-between;align-items:center;padding:15px 0;margin-bottom:15px}.profile-initials{background-color:var(--wc);border-radius:18px;width:36px;height:36px;display:flex;justify-content:center;align-items:center;font-weight:600;font-size:16px;color:var(--g1);}.header-icons{display:flex;gap:20px;font-size:20px;color:var(--g1);text-shadow: -1px -1px 0 var(--wc), 1px -1px 0 var(--wc), -1px 1px 0 var(--wc), 1px 1px 0 var(--wc);}.nav-tabs{display:flex;padding-bottom:15px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none;gap: 13px; -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%); mask-image: linear-gradient(to right, black 90%, transparent 100%);}.nav-tabs::-webkit-scrollbar{display:none}.nav-tab{padding:8px 15px;border-radius:20px;font-size:15px;font-weight:500;cursor:pointer;white-space:nowrap;transition:background-color .3s ease,color .3s ease;text-align:center;background-color:#13666c;color:var(--wc);}.nav-tab.active{background-color:var(--wc);color:var(--g1);}main{flex-grow:1;padding-bottom:calc(80px + var(--pb));box-sizing:border-box;position:relative;background-color:var(--g3);padding-top:20px; width: 100%;}.content-section{display:none;padding:0 20px;}.content-section.active-content{display:block}.account-title-outside{font-size:20px;font-weight:700;color:var(--wc);margin-top:0;margin-bottom:10px;padding-left:20px;display:flex;justify-content:space-between;align-items:center;}.account-title-outside .toggle-icon{font-size:20px;color:var(--g1);text-shadow: -1px -1px 0 var(--wc), 1px -1px 0 var(--wc), -1px 1px 0 var(--wc), 1px 1px 0 var(--wc);margin-right:20px;}
        .account-summary{
            background-color:var(--wc);
            border-radius:16px;
            padding:10px; /* CHANGED: Padding to 10px */
            margin-bottom:25px;
            box-shadow:var(--sh);
            position:relative;
            z-index:10;
            margin-left: 0;
            margin-right: 0;
        }
        .account-summary .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.account-summary .header .toggle-icon{font-size:20px;color:var(--ic)}.account-balance{font-size:32px;font-weight:700;color:var(--g2);margin-bottom:5px;display:flex;align-items:center}.account-balance .arrow-icon{font-size:20px;margin-left:8px;color:var(--g5)}.balance-info{font-size:13px;color:var(--g5);margin-bottom:20px}.iban-details{display:flex;justify-content:space-between;align-items:center;background-color:var(--g6);border-radius:10px;padding:12px 15px;font-size:14px;font-weight:500;color:var(--g2)}.iban-details .copy-icon{color:var(--g5);font-size:18px;cursor:pointer}.quick-actions{display:flex;justify-content:space-around;margin-bottom:15px; padding: 0 20px;}.action-item{display:flex;flex-direction:column;align-items:center;text-align:center;flex:1;position:relative;}.action-item .icon-wrapper{background-color:var(--lc);border-radius:12px;width:60px;height:60px;display:flex;justify-content:center;align-items:center;margin-bottom:8px;font-size:24px;color:var(--ic)}.action-item span{font-size:13px;color:var(--wc);font-weight:500}.action-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 60%;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.3);
        }.action-item .icon-wrapper.inverted-colors {
            background-color: var(--wc);
            color: var(--g1);
        }
        /* MODIFICHE PRINCIPALI */
        .transactions-card-wrapper {
            background-color: var(--wc);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: var(--sh);
            color: var(--g2);
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }

        .transactions-card-wrapper .section-title {
            margin-top: 15px;
            padding: 20px 20px 10px 20px;
        }

        .transactions .transaction-item {
            background-color: var(--wc);
            padding: 0;
            margin-bottom: 0px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all .2s ease;
            border-bottom: 1px solid var(--bc);
        }

        .transactions .transaction-item:last-child {
            border-bottom: none;
        }

        .transactions .transaction-main-info {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            padding: 15px 20px;
        }

        .transactions .transaction-info {
            display: flex;
            align-items: center;
            min-width: 0;
            flex-shrink: 1;
        }

        .transactions .transaction-date {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
            color: var(--g5);
            margin-right: 15px;
            width: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex-shrink: 0;
        }

        .transactions .transaction-description {
            flex-grow: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transactions .transaction-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 3px;
            letter-spacing: -.3px;
            color: var(--g2);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transactions .transaction-type {
            font-size: 12px;
            color: var(--g5);
            letter-spacing: -.2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transactions .transaction-status {
            background-color: var(--bc);
            color: var(--g5);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 5px;
            white-space: nowrap;
        }

        .transactions .transaction-amount {
            font-size: 15px;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 85px;
            text-align: left;
            padding-left: 0px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-left: 3px;
        }

        /* NEW CSS FOR THE CARET ICON */
        .transactions .transaction-amount i {
            font-size: 8px;
            margin-left: 3px;
            vertical-align: middle;
        }

        /* Existing color rules */
        .transactions .transaction-amount.positive{color:var(--mp)}.transactions .transaction-amount.negative{color:var(--mn)}.transactions .transaction-date{font-size:13px;font-weight:600;text-align:center;line-height:1.2;color:var(--g5);margin-right:15px;width:30px; display: block;}.transactions .transaction-details{display:none;margin-top:10px;font-size:13px;color:var(--g5);padding-top:10px;border-top:1px solid var(--bc); padding: 0 20px;}.transactions .transaction-item.expanded .transaction-details{display:block}.transactions .transaction-details p{margin:5px 0}.transactions .transaction-details strong{color:var(--g2)}.view-all-link{text-align:right;margin-top:15px;margin-bottom:25px;font-size:14px;padding-right:20px;}.view-all-link a{color:var(--g5);text-decoration:none;font-weight:500}.promo-card{background-color:var(--g4);border-radius:16px;padding:20px;margin-bottom:25px;box-shadow:var(--sh);display:flex;align-items:center;gap:15px;color:var(--g2);position:relative;overflow:hidden; margin-left: 20px; margin-right: 20px;}.promo-card .promo-content{flex:1}.promo-card .promo-tag{background-color:var(--g3);color:var(--wc);padding:4px 10px;border-radius:8px;font-size:11px;font-weight:700;display:inline-block;margin-bottom:8px}.promo-card h4{font-size:17px;font-weight:700;margin:0 0 5px;color:var(--g2)}.promo-card p{font-size:13px;line-height:1.4;margin:0;color:var(--g5)}.promo-card .arrow-icon{font-size:20px;color:var(--g5)}.placeholder-section{display:flex;flex-direction:column;align-items:center;justify-content:center;height:calc(100vh - 250px);text-align:center;color:var(--g5)}.placeholder-section i{font-size:60px;color:var(--bc);margin-bottom:20px}.placeholder-section h3{font-size:24px;margin-bottom:10px;color:var(--wc)}.placeholder-section p{font-size:16px;line-height:1.5;max-width:80%;color:var(--wc)}.bottom-nav{background-color:var(--wc);border-top:1px solid var(--bc);position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-around;padding:10px 0 calc(10px + var(--pb));box-shadow:0 -2px 10px rgba(0,0,0,.05);z-index:100}.bottom-nav .nav-item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:var(--ic);text-decoration:none;flex:1;padding:5px 0;transition:color .3s ease}.bottom-nav .nav-item i{font-size:22px;margin-bottom:5px}.bottom-nav .nav-item.active{color:var(--g1)}.bottom-nav .nav-item.active i{color:var(--g1)}.all-transactions-header{background-color:var(--g1);color:var(--wc);padding:0;position:sticky;top:0;z-index:90;} /* display:none; REMOVED */
        /* REMOVED: .all-transactions-top-bar and its children CSS */
        .all-transactions-title-bar{display:flex;align-items:center;padding:20px 20px 10px;}.all-transactions-title-bar .back-button{font-size:22px;margin-right:15px;color:var(--wc);cursor:pointer}.all-transactions-title-bar .title-with-subtitle{font-size:20px;font-weight:700;line-height:1.2;margin:0;flex-grow:1}.all-transactions-title-bar .title-with-subtitle .subtitle{font-size:14px;font-weight:500;color:rgba(255,255,255,.7);display:block;margin-top:2px}.search-filter-bar{display:flex;align-items:center;gap:10px;margin-top:15px; padding: 0 20px 15px;}.search-input-wrapper{flex-grow:1;position:relative}.search-input-wrapper input{width:100%;padding:12px 15px 12px 40px;border-radius:12px;border:none;background-color:rgba(255,255,255,.1);color:var(--wc);font-size:15px;outline:none;box-shadow:inset 0 1px 3px rgba(0,0,0,.1)}.search-input-wrapper input::placeholder{color:rgba(255,255,255,.6)}.search-input-wrapper .fa-search{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,.6);font-size:16px}.filter-icons{display:flex;gap:20px;font-size:20px;color:var(--wc)}.all-transactions-content-wrapper{background:var(--wc);border-top-left-radius:16px;border-top-right-radius:16px;padding:20px;flex-grow:1;color:var(--g2);margin-top:-10px;position:relative;z-index:80;padding-bottom:calc(80px + var(--pb))}.section-title-alt{font-size:16px;font-weight:700;color:var(--g2);margin-bottom:15px;letter-spacing:-.3px; padding: 0 20px;}.filter-tabs{display:flex;background-color:var(--g4);border-radius:12px;padding:5px;margin-bottom:20px;justify-content:space-around;align-items:center; margin: 0 20px 20px 20px;}.filter-tab{flex:1;text-align:center;padding:10px 0;font-size:14px;font-weight:500;color:var(--g5);cursor:pointer;transition:all .2s ease}.filter-tab.active{background-color:var(--wc);border-radius:10px;color:var(--g2);box-shadow:0 2px 5px rgba(0,0,0,.05)}.transactions-list-container{ padding: 0 20px;}.transactions-list-container .transaction-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid var(--bc);color:var(--g2)}.transactions-list-container .transaction-item:last-child{border-bottom:none}.transactions-list-container .transaction-info{display:flex;flex-direction:column;flex:1}.transactions-list-container .transaction-date-alt{font-size:13px;font-weight:600;text-align:center;line-height:1.2;color:var(--g5);margin-right:15px;width:30px}.transactions-list-container .transaction-description{flex:1}.transactions-list-container .transaction-name{font-weight:600;font-size:15px;margin-bottom:3px;letter-spacing:-.3px;color:var(--g2)}.transactions-list-container .transaction-type{font-size:12px;color:var(--g5);letter-spacing:-.2px}.transactions-list-container .transaction-amount{font-size:15px;font-weight:600;white-space:nowrap;display:flex;align-items:center;justify-content:flex-end;}.transactions-list-container .transaction-amount i{font-size:8px;margin-left:3px;vertical-align:middle;}.transactions .transaction-amount.positive{color:var(--mp)}.transactions .transaction-amount.negative{color:var(--mn)}.transactions .transaction-date{font-size:13px;font-weight:600;text-align:center;line-height:1.2;color:var(--g5);margin-right:15px;width:30px; display: block;}.transactions-list-container .transaction-date{font-size:13px;font-weight:600;text-align:center;line-height:1.2;color:var(--g5);margin-right:15px;width:30px}.transactions-list-container .transaction-date-alt{display:none}#carte-content .card-display{background-color:var(--g4);border-radius:16px;padding:20px;margin-bottom:25px;box-shadow:var(--sh);text-align:center;color:var(--g2); margin-left: 20px; margin-right: 20px;}#carte-content .card-display img{max-width:100%;height:auto;border-radius:10px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}#carte-content .card-display h3{font-size:18px;margin-bottom:5px}#carte-content .card-display p{font-size:14px;color:var(--g5)}#carte-content .card-actions{display:flex;justify-content:space-around;margin-bottom:25px;padding: 0 20px;}.card-actions .action-item{flex:1;padding:10px}#carte-content .notification-banner{background-color:var(--g4);border-radius:12px;padding:15px;display:flex;align-items:flex-start;gap:10px;font-size:14px;color:var(--g5);margin-bottom:25px; margin-left: 20px; margin-right: 20px;}#carte-content .notification-banner i{color:var(--g5)}#carte-content .notification-banner .close-btn{background:none;border:none;font-size:18px;color:var(--g5);cursor:pointer;padding:0;margin-left:auto}#finanziamenti-content .promo-card{background-color:#d1c4e9;color:#4527a0}#finanziamenti-content .promo-card .promo-tag{background-color:#8c73c8;color:var(--wc)}#finanziamenti-content .promo-card .arrow-icon{color:#4527a0}#finanziamenti-content .promo-card h4{color:#4527a0}#finanziamenti-content .promo-card p{color:#4527a0}#investimenti-content ul li i{color:var(--g5)}#investimenti-content ul li .fa-chevron-right{color:var(--ic)}#investimenti-content ul li{color:var(--g2)}#assicurazioni-content .view-all-link a{color:var(--g5)}#assicurazioni-content .account-summary.promo-pink{background-color:#fce4ec;color:#d81b60}#assicurazioni-content .account-summary.promo-pink .header i,#assicurazioni-content .account-summary.promo-pink h3,#assicurazioni-content .account-summary.promo-pink p,#assicurazioni-content .account-summary.promo-pink span{color:#d81b60}#assicurazioni-content .account-summary.promo-blue{background-color:#e3f2fd;color:#1565c0}#assicurazioni-content .account-summary.promo-blue .header i,#assicurazioni-content .account-summary.promo-blue h3,#assicurazioni-content .account-summary.promo-blue p,#assicurazioni-content .account-summary.promo-blue span{color:#1565c0}#mobilita-content ul li i{color:var(--g5)}#mobilita-content ul li .fa-chevron-right{color:var(--ic)}#mobilita-content ul li{color:var(--g2)}

        /* New CSS for Modal Backdrop */
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            z-index: 109; /* Below the pop-up, above other content */
            opacity: 0;
            visibility: hidden; /* Start hidden for animation */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        #modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        /* New CSS for Transaction Detail Pop-up */
        #transaction-detail-content {
            background-color: var(--wc); /* White background for pop-up */
            color: var(--g2); /* Dark text color for pop-up content */
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0; /* Position at the bottom */
            max-height: 90vh; /* Max height for the pop-up */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2); /* Shadow for pop-up effect */
            z-index: 110;
            display: flex;
            flex-direction: column;
            transform: translateY(100%); /* Start completely off-screen at bottom */
            transition: transform 0.3s ease-in-out;
            visibility: hidden; /* Hidden by default for better animation */
            overflow: hidden; /* Ensures rounded corners and content within stays */
        }

        #transaction-detail-content.active-content {
            transform: translateY(0); /* Animate to visible position */
            visibility: visible; /* Make visible when active */
        }

        /* Ensure header inside pop-up is sticky if content scrolls */
        #transaction-detail-content .all-transactions-header {
            background-color: var(--wc); /* White background for header within pop-up */
            color: var(--g1); /* Dark text for header within pop-up */
            padding: 0;
            position: sticky; /* Make it sticky within the pop-up scroll area */
            top: 0; /* Stick to the top of the pop-up scroll area */
            z-index: 90; /* Ensure it's above other pop-up content if any overlaps */
            box-shadow: none; /* No shadow */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding-top: env(safe-area-inset-top); /* Respect notch/status bar area */
        }

        #transaction-detail-content .all-transactions-title-bar .back-button {
            color: var(--g1); /* Dark color for back button */
        }
        #transaction-detail-content .all-transactions-title-bar .title-with-subtitle {
            color: var(--g2); /* Dark color for title */
        }

        .transaction-detail-wrapper {
            flex-grow: 1;
            padding: 20px;
            padding-bottom: 30px; /* Add more padding at bottom for scroll comfort */
            overflow-y: auto; /* Allow scrolling if content is long */
            background-color: var(--wc); /* White background */
            color: var(--g2); /* Dark text color */
        }

        /* Specific styling for elements in the detail view based on the image */
        .detail-amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--g2); /* Dark amount text, unless negative/positive */
        }

        .detail-amount.negative {
            color: var(--mn); /* Set to g2 from variable */
        }
        .detail-amount.positive {
            color: var(--mp); /* Set to g2 from variable */
        }

        .detail-type {
            font-size: 15px;
            font-weight: 600;
            color: var(--g5); /* Lighter dark color for type */
            margin-bottom: 25px;
        }

        .detail-info-block {
            background-color: var(--g4); /* Light grey background for info block */
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: var(--g2); /* Text color inside info block */
        }

        .detail-info-block h3 {
            font-size: 14px;
            font-weight: 700;
            color: var(--g2);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .detail-info-block p {
            font-size: 13px;
            margin: 5px 0;
            line-height: 1.4;
            color: var(--g5);
        }

        .detail-date-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--bc); /* Lighter border for white background */
            font-size: 14px;
            color: var(--g2); /* Dark text color for dates */
        }

        .detail-date-row:last-of-type {
            border-bottom: none;
        }

        .detail-date-row span:first-child {
            font-weight: 500;
            color: var(--g5); /* Lighter dark color for label */
        }

        .detail-date-row span:last-child {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-top">
            <div class="profile-initials">MS</div>
            <div class="header-icons">
                <i class="fas fa-bell"></i>
                <i class="fas fa-question-circle"></i>
            </div>
        </div>
        <nav class="nav-tabs">
            <div class="nav-tab active" data-target="conti-content">Conti</div>
            <div class="nav-tab" data-target="carte-content">Carte</div>
            <div class="nav-tab" data-target="finanziamenti-content">Finanziamenti</div>
            <div class="nav-tab" data-target="investimenti-content">Investimenti</div>
            <div class="nav-tab" data-target="mutui-content">Mutui</div>
            <div class="nav-tab" data-target="assicurazioni-content">Assicurazioni</div>
            <div class="nav-tab" data-target="mobilita-content">Mobilità</div>
        </nav>
    </header>
    <main>
        <section id="conti-content" class="content-section active-content">
            <h3 class="account-title-outside">
                <span>Conto 3657761</span>
                <i id="toggle-all-visibility" class="fas fa-eye-slash toggle-icon"></i>
            </h3>
            <div class="account-summary">
                <div class="header">
                </div>
                <div class="account-balance">
                    <span id="current-balance" data-current-balance="161.46">161,46 €</span> <i class="fas fa-chevron-right arrow-icon"></i>
                </div>
                <p class="balance-info">Saldo disponibile al 23/06/2025<br><strong>Sy Mouhamadou</strong></p>
                <div class="iban-details">
                    <span id="iban-text">IT25C0538753350000003657761</span>
                    <i id="copy-iban-button" class="fas fa-arrow-up-from-bracket copy-icon"></i>
                </div>
            </div>
            <div class="quick-actions">
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-hand-holding-dollar"></i></div>
                    <span>Bonifico<br>ordinario</span>
                </div>
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-mobile-screen-button"></i></div>
                    <span>Ricarica<br>Telefonica</span>
                </div>
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-file-invoice"></i></div>
                    <span>Cbill e<br>PagoPA</span>
                </div>
            </div>
            <div class="transactions-card-wrapper">
                <h2 class="section-title">ULTIMI MOVIMENTI</h2>
                <div class="transactions">
                    <div class="transaction-item" data-transaction-id="tx556677889" data-accounting-date="23/06/2025" data-currency-date="23/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">23<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">VERSAMENTO DA ATM AZIEN...</div>
                                    <div class="transaction-type">VERSAMENTO</div>
                                </div>
                            </div>
                            <div class="transaction-amount positive" data-original-amount="20.00" id="amount-tx556677889">+20,00 € <i class="fas fa-caret-up"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Versamento contanti</p>
                            <p><strong>ID Transazione:</strong> 556677889</p>
                        </div>
                    </div>
                    <div class="transaction-item" data-transaction-id="tx123456789" data-accounting-date="22/06/2025" data-currency-date="22/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">22<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">LIDL 148 CLUSONE 24023 ITA...</div>
                                    <div class="transaction-type">PAGAMENTO</div>
                                    <div class="transaction-status">Da contabilizzare</div>
                                </div>
                            </div>
                            <div class="transaction-amount negative" data-original-amount="-5.28" id="amount-tx123456789">-5,28 € <i class="fas fa-caret-down"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Pagamento POS</p>
                            <p><strong>ID Transazione:</strong> 123456789</p>
                        </div>
                    </div>
                    <div class="transaction-item" data-transaction-id="tx987654321a" data-accounting-date="21/06/2025" data-currency-date="21/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">21<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">ENERGY SELF ALBINO ALBINO I...</div>
                                    <div class="transaction-type">PAGAMENTO</div>
                                    <div class="transaction-status">Da contabilizzare</div>
                                </div>
                            </div>
                            <div class="transaction-amount negative" data-original-amount="-4.77" id="amount-tx987654321a">-4,77 € <i class="fas fa-caret-down"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Pagamento carburante</p>
                            <p><strong>ID Transazione:</strong> 987654321</p>
                        </div>
                    </div>
                    <div class="transaction-item" data-transaction-id="tx112233445" data-accounting-date="20/06/2025" data-currency-date="20/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">20<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">LIDL 2079 BERGAMO ITA Opera...</div>
                                    <div class="transaction-type">PAGAMENTO</div>
                                </div>
                            </div>
                            <div class="transaction-amount negative" data-original-amount="-3.28" id="amount-tx112233445">-3,28 € <i class="fas fa-caret-down"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Pagamento POS</p>
                            <p><strong>ID Transazione:</strong> 112233445</p>
                        </div>
                    </div>
                    <div class="transaction-item" data-transaction-id="tx123456789b" data-accounting-date="19/06/2025" data-currency-date="19/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">19<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">ALDI S.R.L. PEDRENGO ITA Ope...</div>
                                    <div class="transaction-type">PAGAMENTO</div>
                                </div>
                            </div>
                            <div class="transaction-amount negative" data-original-amount="-4.24" id="amount-tx123456789b">-4,24 € <i class="fas fa-caret-down"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Pagamento POS</p>
                            <p><strong>ID Transazione:</strong> 123456789</p>
                        </div>
                    </div>
                    <div class="transaction-item" data-transaction-id="tx987654321c" data-accounting-date="17/06/2025" data-currency-date="17/06/2025">
                        <div class="transaction-main-info">
                            <div class="transaction-info">
                                <div class="transaction-date">17<br>giu</div>
                                <div class="transaction-description">
                                    <div class="transaction-name">HO-MOBILE.IT - RICARIC MILA...</div>
                                    <div class="transaction-type">PAGAMENTO ONLINE</div>
                                </div>
                            </div>
                            <div class="transaction-amount negative" data-original-amount="-10.00" id="amount-tx987654321c">-10,00 € <i class="fas fa-caret-down"></i></div>
                        </div>
                        <div class="transaction-details">
                            <p><strong>Dettagli:</strong> Ricarica mobile</p>
                            <p><strong>ID Transazione:</strong> 987654321</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="view-all-link">
                <a href="#">Vedi tutti i movimenti <i class="fas fa-chevron-right"></i></a>
            </div>
            <div class="promo-card">
                <div class="promo-content">
                    <span class="promo-tag">NOVITÀ</span>
                    <h4>Prestiti Personali</h4>
                    <p>Richiedi un prestito in pochi passaggi, direttamente dall'app!</p>
                </div>
                <i class="fas fa-chevron-right arrow-icon"></i>
            </div>
        </section>

        <section id="carte-content" class="content-section">
            <h3 class="account-title-outside">
                <span>Le Tue Carte</span>
            </h3>
            <div class="card-display">
                <img src="https://via.placeholder.com/300x180?text=La+tua+Carta" alt="Esempio di carta BPER Banca">
                <h3>BPER Card Platinum</h3>
                <p>**** **** **** 1234</p>
            </div>
            <div class="quick-actions card-actions">
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-lock"></i></div>
                    <span>Blocca<br>Carta</span>
                </div>
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-gear"></i></div>
                    <span>Gestisci<br>Limiti</span>
                </div>
                <div class="action-item">
                    <div class="icon-wrapper inverted-colors"><i class="fas fa-clock-rotate-left"></i></div>
                    <span>Ultimi<br>Movimenti</span>
                </div>
            </div>
            <div class="notification-banner">
                <i class="fas fa-info-circle"></i>
                <span>Hai delle spese non contabilizzate. Controlla i movimenti della tua carta.</span>
                <button class="close-btn"><i class="fas fa-times"></i></button>
            </div>
        </section>

        <section id="finanziamenti-content" class="content-section">
            <h3 class="account-title-outside">
                <span>I Tuoi Finanziamenti</span>
            </h3>
            <div class="promo-card">
                <div class="promo-content">
                    <span class="promo-tag">SCOPRI</span>
                    <h4>Richiedi un Nuovo Prestito</h4>
                    <p>Simula la rata e ottieni subito un preventivo personalizzato.</p>
                </div>
                <i class="fas fa-chevron-right arrow-icon"></i>
            </div>
            <div class="account-summary">
                <div class="header">
                    <h3>Mutuo Casa</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Rata mensile: <strong>450,00 €</strong></p>
                <p class="balance-info">Prossima scadenza: <strong>10/07/2025</strong></p>
            </div>
            <div class="account-summary">
                <div class="header">
                    <h3>Prestito Auto</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Rata mensile: <strong>180,00 €</strong></p>
                <p class="balance-info">Prossima scadenza: <strong>05/07/2025</strong></p>
            </div>
        </section>

        <section id="investimenti-content" class="content-section">
            <h3 class="account-title-outside">
                <span>I Tuoi Investimenti</span>
            </h3>
            <div class="account-summary">
                <div class="header">
                    <h3>Portafoglio Fondi</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Valore totale: <strong>15.200,50 €</strong></p>
                <p class="balance-info">Rendimento YTD: <strong style="color: green;">+3,5%</strong></p>
            </div>
            <div class="account-summary">
                <div class="header">
                    <h3>Titoli Azionari</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Valore totale: <strong>8.750,20 €</strong></p>
                <p class="balance-info">Rendimento YTD: <strong style="color: red;">-1,2%</strong></p>
            </div>
        </section>

        <section id="mutui-content" class="content-section">
            <h3 class="account-title-outside">
                <span>I Tuoi Mutui</span>
            </h3>
            <div class="account-summary">
                <div class="header">
                    <h3>Mutuo Prima Casa</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Rata mensile: <strong>550,00 €</strong></p>
                <p class="balance-info">Scadenza: <strong>15/07/2035</strong></p>
            </div>
            <div class="promo-card">
                <div class="promo-content">
                    <span class="promo-tag">NOVITÀ</span>
                    <h4>Surroga il tuo Mutuo</h4>
                    <p>Scopri le nostre offerte per migliorare le condizioni del tuo mutuo.</p>
                </div>
                <i class="fas fa-chevron-right arrow-icon"></i>
            </div>
        </section>

        <section id="assicurazioni-content" class="content-section">
            <h3 class="account-title-outside">
                <span>Le Tue Assicurazioni</span>
            </h3>
            <div class="account-summary promo-pink">
                <div class="header">
                    <h3>Assicurazione Auto</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Scadenza polizza: <strong>20/12/2025</strong></p>
                <p class="balance-info">Premio annuale: <strong>350,00 €</strong></p>
            </div>
            <div class="account-summary promo-blue">
                <div class="header">
                    <h3>Assicurazione Casa</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Scadenza polizza: <strong>01/09/2026</strong></p>
                <p class="balance-info">Premio annuale: <strong>120,00 €</strong></p>
            </div>
            <div class="view-all-link">
                <a href="#">Vedi tutte le polizze <i class="fas fa-chevron-right"></i></a>
            </div>
        </section>

        <section id="mobilita-content" class="content-section">
            <h3 class="account-title-outside">
                <span>Servizi Mobilità</span>
            </h3>
            <div class="account-summary">
                <div class="header">
                    <h3>Pagamento Bollo Auto</h3>
                    <i class="fas fa-chevron-right toggle-icon"></i>
                </div>
                <p class="balance-info">Prossima scadenza: <strong>31/01/2026</strong></p>
            </div>
            <div class="promo-card">
                <div class="promo-content">
                    <span class="promo-tag">NUOVO</span>
                    <h4>Ricarica la tua BPER Card Trasporti</h4>
                    <p>Gestisci i pagamenti per i mezzi pubblici direttamente dall'app.</p>
                </div>
                <i class="fas fa-chevron-right arrow-icon"></i>
            </div>
        </section>

        <div id="modal-backdrop"></div>

        <div id="transaction-detail-content">
            <div class="all-transactions-header">
                <div class="all-transactions-title-bar">
                    <i class="fas fa-arrow-left back-button" id="detail-back-button"></i>
                    <h1 class="title-with-subtitle">
                        Dettaglio Movimento
                    </h1>
                </div>
            </div>
            <div class="transaction-detail-wrapper">
                <div id="detail-amount" class="detail-amount"></div>
                <div id="detail-type" class="detail-type"></div>

                <div class="detail-info-block">
                    <h3 id="detail-info-block-title"></h3>
                    <p id="detail-description"></p>
                </div>

                <div class="detail-date-row">
                    <span>Data Contabile</span>
                    <span id="detail-accounting-date"></span>
                </div>
                <div class="detail-date-row">
                    <span>Data Valuta</span>
                    <span id="detail-currency-date"></span>
                </div>

                <div class="detail-date-row">
                    <span>ID Transazione</span>
                    <span id="detail-transaction-id"></span>
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <i class="fas fa-house"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-money-bill-transfer"></i>
            <span>Pagamenti</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-chart-line"></i>
            <span>Investi</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-headset"></i>
            <span>Contatti</span>
        </a>
        <a href="#" class="nav-item">
            <i class="fas fa-ellipsis"></i>
            <span>Altro</span>
        </a>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Navigation Tabs Logic ---
            const navTabs = document.querySelectorAll('.nav-tab');
            const contentSections = document.querySelectorAll('.content-section');

            navTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and content sections
                    navTabs.forEach(t => t.classList.remove('active'));
                    contentSections.forEach(s => s.classList.remove('active-content'));

                    // Add active class to clicked tab
                    tab.classList.add('active');

                    // Show the corresponding content section
                    const targetId = tab.dataset.target;
                    document.getElementById(targetId).classList.add('active-content');
                });
            });

            // --- Toggle Account Balance Visibility ---
            const currentBalanceSpan = document.getElementById('current-balance');
            const toggleAllVisibilityIcon = document.getElementById('toggle-all-visibility');
            const originalBalanceText = currentBalanceSpan.textContent; // Store initial text content
            let isBalanceHidden = false;

            toggleAllVisibilityIcon.addEventListener('click', () => {
                if (isBalanceHidden) {
                    // If currently hidden, show original balance from data-current-balance
                    const currentBalanceValue = parseFloat(currentBalanceSpan.dataset.currentBalance);
                    currentBalanceSpan.textContent = currentBalanceValue.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' });
                    toggleAllVisibilityIcon.classList.remove('fa-eye');
                    toggleAllVisibilityIcon.classList.add('fa-eye-slash');
                } else {
                    currentBalanceSpan.textContent = '****,** €';
                    toggleAllVisibilityIcon.classList.remove('fa-eye-slash');
                    toggleAllVisibilityIcon.classList.add('fa-eye');
                }
                isBalanceHidden = !isBalanceHidden;
            });


            // --- Copy IBAN functionality ---
            const copyIbanButton = document.getElementById('copy-iban-button');
            const ibanText = document.getElementById('iban-text');

            if (copyIbanButton) {
                copyIbanButton.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(ibanText.textContent);
                        alert('IBAN copiato negli appunti!');
                    } catch (err) {
                        console.error('Errore durante la copia dell\'IBAN: ', err);
                        alert('Impossibile copiare l\'IBAN. Prova manualmente.');
                    }
                });
            }

            // --- Long Press Logic for Balance & Transactions ---
            const LONG_PRESS_DURATION = 500; // 0.5 seconds for a more responsive feel

            let pressTimer;
            let isLongPress = false; // Flag to differentiate between long press and click/tap

            const startPressTimer = (callback) => {
                isLongPress = false; // Reset flag for new press
                clearTimeout(pressTimer); // Clear any existing timer
                pressTimer = setTimeout(() => {
                    isLongPress = true; // Mark as long press
                    callback();
                }, LONG_PRESS_DURATION);
            };

            const endPressTimer = () => {
                clearTimeout(pressTimer);
            };

            // --- PERSISTENCE: Load data on page load ---
            // Load persisted balance
            const persistedBalance = localStorage.getItem('persistedBalance');
            if (persistedBalance !== null) {
                const parsedBalance = parseFloat(persistedBalance);
                if (!isNaN(parsedBalance)) {
                    currentBalanceSpan.textContent = parsedBalance.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' });
                    currentBalanceSpan.dataset.currentBalance = parsedBalance;
                }
            }

            // Load persisted transactions
            const transactionItems = document.querySelectorAll('.transaction-item');
            const persistedTransactions = JSON.parse(localStorage.getItem('persistedTransactions') || '[]');

            persistedTransactions.forEach(pTrans => {
                const targetTransactionAmountSpan = document.getElementById(`amount-${pTrans.id}`);
                if (targetTransactionAmountSpan) {
                    const newAmount = parseFloat(pTrans.amount);
                    if (!isNaN(newAmount)) {
                        let caretIcon = '';
                        targetTransactionAmountSpan.classList.remove('positive', 'negative'); // Clear existing classes
                        if (newAmount > 0) {
                            caretIcon = ' <i class="fas fa-caret-up"></i>';
                            targetTransactionAmountSpan.classList.add('positive');
                        } else if (newAmount < 0) {
                            caretIcon = ' <i class="fas fa-caret-down"></i>';
                            targetTransactionAmountSpan.classList.add('negative');
                        }
                        targetTransactionAmountSpan.innerHTML = newAmount.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' }) + caretIcon;
                        targetTransactionAmountSpan.dataset.originalAmount = newAmount;
                    }
                }
            });
            // --- END PERSISTENCE LOADING ---

            // --- Current Balance Long Press Handler ---
            const handleBalanceLongPress = () => {
                const currentBalanceValue = parseFloat(currentBalanceSpan.dataset.currentBalance);
                const newBalanceStr = prompt(`Inserisci il nuovo saldo disponibile (attuale: ${currentBalanceValue.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' })}):`);
                if (newBalanceStr !== null) {
                    const newBalance = parseFloat(newBalanceStr.replace(',', '.')); // Handle comma as decimal
                    if (!isNaN(newBalance)) {
                        currentBalanceSpan.textContent = newBalance.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' });
                        currentBalanceSpan.dataset.currentBalance = newBalance; // Update data attribute

                        // --- PERSISTENCE: Save the new balance ---
                        localStorage.setItem('persistedBalance', newBalance.toString());
                        // ------------------------------------------

                        alert("Saldo aggiornato con successo!");
                        // If balance was hidden, update it after modification
                        if (isBalanceHidden) {
                             currentBalanceSpan.textContent = '****,** €';
                        }
                    } else {
                        alert("Importo non valido. Inserisci un numero.");
                    }
                }
            };

            currentBalanceSpan.addEventListener('touchstart', (e) => startPressTimer(handleBalanceLongPress));
            currentBalanceSpan.addEventListener('touchend', endPressTimer);
            currentBalanceSpan.addEventListener('touchcancel', endPressTimer);
            currentBalanceSpan.addEventListener('mousedown', (e) => startPressTimer(handleBalanceLongPress));
            currentBalanceSpan.addEventListener('mouseup', endPressTimer);
            currentBalanceSpan.addEventListener('mouseleave', endPressTimer);


            // --- Transaction Detail Pop-up Elements ---
            const modalBackdrop = document.getElementById('modal-backdrop');
            const transactionDetailContent = document.getElementById('transaction-detail-content');
            const detailBackButton = document.getElementById('detail-back-button');

            const detailAmount = document.getElementById('detail-amount');
            const detailType = document.getElementById('detail-type');
            const detailInfoBlockTitle = document.getElementById('detail-info-block-title');
            const detailDescription = document.getElementById('detail-description');
            const detailAccountingDate = document.getElementById('detail-accounting-date');
            const detailCurrencyDate = document.getElementById('detail-currency-date');
            const detailTransactionId = document.getElementById('detail-transaction-id');

            const showTransactionDetails = (item) => {
                const name = item.querySelector('.transaction-name').textContent;
                const type = item.querySelector('.transaction-type').textContent;
                const amount = item.querySelector('.transaction-amount').dataset.originalAmount;
                const transactionIdFromElement = item.dataset.transactionId;
                const accountingDate = item.dataset.accountingDate || 'N/A';
                const currencyDate = item.dataset.currencyDate || 'N/A';

                let detailText = '';
                let infoBlockTitle = 'Dettagli';

                // Attempt to get details from the hidden transaction-details div first
                const existingDetailsParagraph = item.querySelector('.transaction-details p:first-child');
                if (existingDetailsParagraph) {
                    detailText = existingDetailsParagraph.textContent.replace('Dettagli: ', '');
                } else {
                    // Fallback to specific logic if no generic details paragraph is found
                    if (name.includes('VERSAMENTO')) {
                        detailText = 'Versamento contanti presso ATM.';
                        infoBlockTitle = 'Informazioni Operazione';
                    } else if (name.includes('LIDL') || name.includes('ALDI')) {
                        detailText = 'Pagamento POS presso supermercato.';
                        infoBlockTitle = 'Acquisto';
                    } else if (name.includes('ENERGY SELF')) {
                        detailText = 'Pagamento carburante.';
                        infoBlockTitle = 'Rifornimento';
                    } else if (name.includes('HO-MOBILE.IT')) {
                        detailText = 'Ricarica telefonica online.';
                        infoBlockTitle = 'Servizio';
                    } else {
                        detailText = 'Dettagli non disponibili.';
                    }
                }


                // Populate the pop-up fields
                detailAmount.textContent = parseFloat(amount).toLocaleString('it-IT', { style: 'currency', currency: 'EUR' });
                detailAmount.classList.remove('positive', 'negative');
                if (parseFloat(amount) >= 0) {
                    detailAmount.classList.add('positive');
                } else {
                    detailAmount.classList.add('negative');
                }

                detailType.textContent = type;
                detailInfoBlockTitle.textContent = infoBlockTitle;
                detailDescription.textContent = detailText;
                detailAccountingDate.textContent = accountingDate;
                detailCurrencyDate.textContent = currencyDate;
                detailTransactionId.textContent = transactionIdFromElement;

                // Show the pop-up and backdrop
                modalBackdrop.classList.add('active');
                transactionDetailContent.classList.add('active-content');
            };

            const hideTransactionDetails = () => {
                modalBackdrop.classList.remove('active');
                transactionDetailContent.classList.remove('active-content');
            };

            detailBackButton.addEventListener('click', hideTransactionDetails);
            modalBackdrop.addEventListener('click', hideTransactionDetails);

            // --- Transaction Item Long Press & Click Logic ---
            transactionItems.forEach(item => {
                item.addEventListener('touchstart', (e) => {
                    startPressTimer(() => {
                        handleTransactionLongPress(e);
                    });
                });

                item.addEventListener('touchend', (e) => {
                    endPressTimer();
                    if (!isLongPress) {
                        // It was a short tap/click, show details
                        showTransactionDetails(item);
                    }
                });
                item.addEventListener('touchcancel', endPressTimer);

                // For desktop (mouse events)
                item.addEventListener('mousedown', (e) => {
                    startPressTimer(() => {
                        handleTransactionLongPress(e);
                    });
                });

                item.addEventListener('mouseup', (e) => {
                    endPressTimer();
                    if (!isLongPress) {
                        // It was a short tap/click, show details
                        showTransactionDetails(item);
                    }
                });
                item.addEventListener('mouseleave', endPressTimer);

                // Long press handler for individual transactions
                const handleTransactionLongPress = (event) => {
                    const transactionItem = event.currentTarget;
                    const transactionName = transactionItem.querySelector('.transaction-name').textContent;
                    const transactionAmountSpan = transactionItem.querySelector('.transaction-amount');
                    const originalAmount = parseFloat(transactionAmountSpan.dataset.originalAmount);

                    const newAmountStr = prompt(`Inserisci il nuovo importo per "${transactionName}" (attuale: ${originalAmount.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' })}):`);

                    if (newAmountStr !== null) {
                        const newAmount = parseFloat(newAmountStr.replace(',', '.'));
                        if (!isNaN(newAmount)) {
                            // Update display with caret icon
                            let caretIcon = '';
                            transactionAmountSpan.classList.remove('positive', 'negative'); // Clear existing classes
                            if (newAmount > 0) {
                                caretIcon = ' <i class="fas fa-caret-up"></i>';
                                transactionAmountSpan.classList.add('positive');
                            } else if (newAmount < 0) {
                                caretIcon = ' <i class="fas fa-caret-down"></i>';
                                transactionAmountSpan.classList.add('negative');
                            }
                            transactionAmountSpan.innerHTML = newAmount.toLocaleString('it-IT', { style: 'currency', currency: 'EUR' }) + caretIcon;
                            transactionAmountSpan.dataset.originalAmount = newAmount; // Update data attribute

                            // --- PERSISTENCE: Save the updated transaction ---
                            const transactionId = transactionItem.dataset.transactionId;
                            let persistedTransactions = JSON.parse(localStorage.getItem('persistedTransactions') || '[]');

                            let found = false;
                            for (let i = 0; i < persistedTransactions.length; i++) {
                                if (persistedTransactions[i].id === transactionId) {
                                    persistedTransactions[i].amount = newAmount;
                                    found = true;
                                    break;
                                }
                            }
                            if (!found) {
                                // This case should ideally not happen for existing items, but ensures new ones are added
                                persistedTransactions.push({ id: transactionId, amount: newAmount });
                            }
                            localStorage.setItem('persistedTransactions', JSON.stringify(persistedTransactions));
                            // ------------------------------------------------

                            alert("Importo transazione aggiornato con successo!");
                        } else {
                            alert("Importo non valido. Inserisci un numero.");
                        }
                    }
                };
            });
        });
    </script>
</body>
</html>
